<!-- Corpus Callosum -->
                <tr>
                    <td rowspan="5">CORPUS CALLOSUM</td>
                    <td>Splenium</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Body</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Genu</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Atrophy-Splenium</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Atrophy-Genu</td>
                    <td>1</td>
                </tr>
                <!-- Visual Pathway -->
                <tr>
                    <td rowspan="3">VISUAL PATHWAY</td>
                    <td>Optic Radiations</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Lateral Geniculate Body</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Meyer's Loop</td>
                    <td>1</td>
                </tr>
                <!-- Auditory Pathway -->
                <tr>
                    <td rowspan="4">AUDITORY PATHWAY</td>
                    <td>Medial Geniculate Body</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Brachium to Inferior Colliculus</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Lateral Lemniscus (Midbrain)</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Lateral Lemniscus (Pons)</td>
                    <td>1</td>
                </tr>
                <!-- Projection Fibers -->
                <tr>
                    <td rowspan="2">PROJECTION FIBERS</td>
                    <td>Internal Capsule</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Brain Stem</td>
                    <td>1</td>
                </tr>
                <!-- Miscellaneous -->
                <tr>
                    <td rowspan="3">MISCELLANEOUS</td>
                    <td>Basal Ganglia</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Cerebellum</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Anterior Thalamus</td>
                    <td>1</td>
                </tr>
                <!-- Atrophy -->
                <tr>
                    <td rowspan="3">ATROPHY</td>
                    <td>Global</td>
                    <td>1-3</td>
                </tr>
                <tr>
                    <td>Brain Stem</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Cerebellar</td>
                    <td>1</td>
                </tr>
                <!-- Maximum Severity Score -->
                <tr>
                    <td colspan="3"><strong>MAXIMUM SEVERITY SCORE: 34</strong></td>
                </tr>
            </tbody>
        </table>
        <p></p>
    `;
}

function loadImages(groupName) {
    const slices = {
        'ACOUSTIC': [31, 36, 41, 46, 51, 56, 61, 66, 68, 69, 71, 73, 78, 83],
        'ANTERIOR_TEMPORAL': [24, 29, 34, 39, 44, 49, 54, 59, 64, 69, 74, 79, 84, 89],
        'CORPUS_CALLOSUM': [65, 70, 75, 80, 85, 90, 95, 100, 105],
        'CORTICOSPINAL': [10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100],
        'FRONTAL': [48, 53, 58, 63, 68, 73, 78, 83, 88, 93, 98, 103, 108, 113, 118, 123, 128, 133, 138, 143, 148],
        'MISC': [12, 17, 22, 27, 32, 37, 42, 47, 52, 57, 62, 67, 72, 77, 82, 87, 92, 97],
        'OPTIC': [60, 63, 67, 68, 69, 70, 71, 74, 78, 82, 86, 90, 93],
        'PARIETO_OCCIPITAL': [52, 57, 62, 67, 72, 77, 82, 87, 92, 97, 102, 107, 112, 117, 122, 127, 132, 137, 142, 147],
        'THALAMUS': [65, 70, 75, 80, 85, 90]
    };

    // Define structure names for each group, with unique color for each substructure, displayed in bold
    const structureNames = {
        'ACOUSTIC': '<span style="color:#54489d;"><strong>Brachium</strong></span>, <span style="color:#efbf42;"><strong>Lateral Lemniscus</strong></span>, <span style="color:#6ff539;"><strong>Medial Geniculate</strong></span>, <span style="color:#d0ef3a;"><strong>Pons</strong></span>',
        'ANTERIOR_TEMPORAL': '<span style="color:#3da437;"><strong>Deep</strong></span>, <span style="color:#4d4caa;"><strong>Middle</strong></span>, <span style="color:#f99442;"><strong>Superficial</strong></span>',
        'CORPUS_CALLOSUM': '<span style="color:#44afdd;"><strong>Body</strong></span>, <span style="color:#f5d846;"><strong>Genu</strong></span>, <span style="color:#c5f345;"><strong>Splenium</strong></span>',
        'CORTICOSPINAL': '<span style="color:#cb464a;"><strong>Brainstem</strong></span>, <span style="color:#4eb277;"><strong>Internal Capsule</strong></span>',
        'FRONTAL': '<span style="color:#f3e366;"><strong>Deep</strong></span>, <span style="color:#f9d240;"><strong>Middle</strong></span>, <span style="color:#393939;"><strong>Superficial</strong></span>',
        'MISC': '<span style="color:#e93e3f;"><strong>Basal Ganglia</strong></span>, <span style="color:#7e2587;"><strong>Cerebellum</strong></span>',
        'OPTIC': '<span style="color:#48ad56;"><strong>Lateral Geniculate</strong></span>, <span style="color:#cb534c;"><strong>Meyers Loop</strong></span>, <span style="color:#58a1d5;"><strong>Radiations</strong></span>',
        'PARIETO_OCCIPITAL': '<span style="color:#e14549;"><strong>Deep</strong></span>, <span style="color:#4649d9;"><strong>Middle</strong></span>, <span style="color:#3fa2d9;"><strong>Superficial</strong></span>',
        'THALAMUS': '<span style="color:#2dafbb;"><strong>Anterior Thalamus</strong></span>'
    };

    const middleIndex = Math.floor(slices[groupName].length / 2); // Calculate middle index for the slider

    const container = document.getElementById('content');
    container.innerHTML = `
        <div style="text-align: center;">
            <div class="structure-header">Structures in ${groupName}: ${structureNames[groupName]}</div>
            <img id="current-slice" src="images/${groupName}/${groupName}_slice_${slices[groupName][middleIndex]}.jpeg" alt="Current Slice">
            <p class="slider-instruction">Drag the slider to view different slices:</p>
            <input type="range" id="slice-slider" class="slider" min="0" max="${slices[groupName].length - 1}" value="${middleIndex}" step="1" oninput="updateImage('${groupName}', ${JSON.stringify(slices[groupName])})" ontouchmove="updateImage('${groupName}', ${JSON.stringify(slices[groupName])})">
        </div>
    `;

    document.getElementById('slice-slider').addEventListener('touchstart', function() {
        this.focus(); // Enhances focus when touched, improving responsiveness
    });
}

function updateImage(groupName, slices) {
    const slider = document.getElementById('slice-slider');
    const img = document.getElementById('current-slice');
    const sliceIndex = slices[slider.value];
    img.src = `images/${groupName}/${groupName}_slice_${sliceIndex}.jpeg`;
}

// New functions for the Interactive Viewer
function showViewer() {
    const container = document.getElementById('content');
    container.innerHTML = `
        <h2>Interactive Brain Atlas Viewer</h2>
        <div id="viewerContainer">
            <div id="papayaContainer"></div>
            <div id="regionControls"></div>
        </div>
    `;

    try {
        let params = [];
        params['images'] = ['data/template.nii.gz', 'data/atlas.nii.gz'];
        params['atlas.nii.gz'] = {
            lut: "Spectrum",
            alpha: 0.5,
            min: 0,
            max: 45
        };

        papaya.Container.addViewer("papayaContainer", params, function(err, viewer) {
            if (err) {
                console.error("Error loading viewer:", err);
                container.innerHTML += `<p>Error loading viewer: ${err.message}</p>`;
            } else {
                console.log("Viewer loaded successfully");
                createRegionLabels(viewer);
            }
        });
    } catch (error) {
        console.error("Error initializing Papaya viewer:", error);
        container.innerHTML += `<p>Error loading viewer: ${error.message}</p>`;
    }
}

function createRegionLabels(viewer) {
    const controlsContainer = document.getElementById('regionControls');
    Object.entries(regionLabels).forEach(([index, { shortName, fullName }]) => {
        const label = document.createElement('div');
        label.className = 'region-label';
        label.textContent = fullName;
        label.addEventListener('mouseover', () => showRegion(viewer, index));
        label.addEventListener('mouseout', () => showFullAtlas(viewer));
        controlsContainer.appendChild(label);
    });
}

function showRegion(viewer, index) {
    // Implementation depends on how your atlas is structured
    // This is a placeholder function
    console.log(`Showing region: ${index}`);
}

function showFullAtlas(viewer) {
    // Implementation depends on how your atlas is structured
    // This is a placeholder function
    console.log("Showing full atlas");
}

// Load region labels
const regionLabels = {};
fetch('data/region_labels.txt')
    .then(response => response.text())
    .then(text => {
        text.split('\n').forEach(line => {
            if (line.trim() !== '') {
                const [index, shortName, fullName] = line.split('\t');
                regionLabels[index] = { shortName, fullName };
            }
        });
    })
    .catch(error => console.error('Error loading region labels:', error));

</script>

</body>
</html>